<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر سوبرماكس - تجربة تسوق فريدة</title>
    <!-- تحسين أداء التحميل -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-color: rgba(0, 179, 0, 0.9);
            --primary-dark: rgba(0, 122, 0, 0.95);
            --secondary-color: rgba(255, 107, 0, 0.9);
            --accent-color: rgba(255, 215, 0, 0.9);
            --bg-color: rgba(255, 255, 255, 0.15);
            --text-color: #fff;
            --light-text: rgba(255, 255, 255, 0.8);
            --dark-text: #333;
            --card-bg: rgba(255, 255, 255, 0.37);
            --card-radius: 16px;
            --blur: blur(9.3px);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --nav-height: 80px;
            --border: 1px solid rgba(255, 255, 255, 0.25);
            --shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Tajawal', Arial, sans-serif;
            color: var(--text-color);
            min-height: 100vh;
            padding-top: var(--nav-height);
            background: url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80') center/cover no-repeat fixed;
            background-attachment: fixed;
            line-height: 1.6;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%);
            z-index: -1;
        }

        /* تحسينات شريط التنقل */
        .navbar {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: var(--nav-height);
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 5%;
            z-index: 1000;
            border-bottom: var(--border);
            box-shadow: var(--shadow);
        }

        .logo {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo i {
            margin-left: 12px;
            color: var(--secondary-color);
            font-size: 1.8rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 15px;
        }

        .nav-links li {
            position: relative;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            transition: var(--transition);
            padding: 8px 15px;
            border-radius: 50px;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-links a:hover, .nav-links a.active {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .nav-links a i {
            font-size: 1.1rem;
        }

        .nav-icons {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            box-shadow: var(--shadow);
        }

        .nav-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--secondary-color);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 0.75rem;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--text-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .user-avatar:hover {
            transform: scale(1.1);
            border-color: var(--primary-color);
        }

        /* تحسينات المحتوى الرئيسي */
        .container {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 5%;
        }

        /* قسم الهيرو المحسن */
        .hero {
            height: 500px;
            border-radius: var(--card-radius);
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            margin-bottom: 50px;
            display: flex;
            overflow: hidden;
            position: relative;
            border: var(--border);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .hero:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .hero-content {
            flex: 1;
            padding: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            z-index: 2;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 25px;
            line-height: 1.2;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 35px;
            color: var(--light-text);
            max-width: 600px;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .hero-btn {
            padding: 15px 35px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 179, 0, 0.3);
        }

        .hero-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 179, 0, 0.4);
        }

        .hero-btn.secondary {
            background: var(--secondary-color);
            box-shadow: 0 5px 15px rgba(255, 107, 0, 0.3);
        }

        .hero-btn.secondary:hover {
            background: rgba(255, 85, 0, 0.9);
            box-shadow: 0 8px 20px rgba(255, 107, 0, 0.4);
        }

        .hero-image {
            flex: 1;
            background: url('https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80') center/cover no-repeat;
            opacity: 0.9;
            transition: var(--transition);
        }

        .hero:hover .hero-image {
            opacity: 1;
            transform: scale(1.02);
        }

        /* تحسينات قسم المنتجات */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .section-title {
            font-size: 2.5rem;
            margin: 0;
            position: relative;
            display: inline-block;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -12px;
            right: 0;
            width: 80px;
            height: 5px;
            background: var(--primary-color);
            border-radius: 3px;
        }

        .section-link {
            color: var(--light-text);
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .section-link:hover {
            color: var(--text-color);
            transform: translateX(-5px);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        /* بطاقة المنتج المحسنة */
        .product-card {
            background: var(--card-bg);
            border-radius: var(--card-radius);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: var(--border);
            box-shadow: var(--shadow);
        }

        .product-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .product-badge {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--secondary-color);
            color: white;
            padding: 6px 18px;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: bold;
            z-index: 2;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .discount-badge {
            background: var(--primary-color);
        }

        .new-badge {
            background: var(--accent-color);
            color: var(--dark-text);
        }

        .product-image-container {
            width: 100%;
            height: 220px;
            border-radius: var(--card-radius);
            overflow: hidden;
            margin-bottom: 25px;
            position: relative;
            border: var(--border);
            transition: var(--transition);
        }

        .product-card:hover .product-image-container {
            transform: scale(1.03);
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .product-card:hover .product-image {
            transform: scale(1.1);
        }

        .product-name {
            font-size: 1.3rem;
            margin: 15px 0;
            font-weight: 700;
            min-height: 3.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-price {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .current-price {
            color: var(--text-color);
            font-size: 1.6rem;
            font-weight: bold;
        }

        .original-price {
            color: var(--light-text);
            text-decoration: line-through;
            font-size: 1.1rem;
        }

        .product-rating {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 15px 0;
            color: var(--accent-color);
        }

        .product-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        .action-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-color);
            font-size: 1.1rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .add-to-cart {
            flex: 1;
            border-radius: 50px;
            padding: 0 25px;
            background: var(--primary-color);
            color: white;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: 0 5px 15px rgba(0, 179, 0, 0.3);
        }

        .add-to-cart:hover {
            background: var(--primary-dark);
            box-shadow: 0 8px 20px rgba(0, 179, 0, 0.4);
        }

        /* تحسينات تصفية المنتجات */
        .filter-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 25px;
        }

        .search-container {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 16px 55px 16px 25px;
            border: var(--border);
            border-radius: 50px;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            font-size: 1.1rem;
            color: var(--text-color);
            outline: none;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .search-input:focus {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .search-input::placeholder {
            color: var(--light-text);
        }

        .search-icon {
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .category-filter {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 12px 25px;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
            color: var(--text-color);
            font-size: 1rem;
            box-shadow: var(--shadow);
        }

        .category-btn:hover, .category-btn.active {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 179, 0, 0.3);
        }

        .category-btn.offer {
            background: var(--accent-color);
            color: var(--dark-text);
        }

        .category-btn.offer:hover {
            background: rgba(255, 215, 0, 0.8);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }

        /* تحسينات التذييل */
        footer {
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            padding: 60px 5% 30px;
            border-top: var(--border);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 50px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .footer-column h3 {
            font-size: 1.5rem;
            margin-bottom: 25px;
            position: relative;
            display: inline-block;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 0;
            width: 60px;
            height: 4px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 15px;
        }

        .footer-links a {
            text-decoration: none;
            color: var(--light-text);
            transition: var(--transition);
            display: block;
            padding: 8px 0;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-links a:hover {
            color: var(--text-color);
            transform: translateX(-8px);
        }

        .footer-links a i {
            font-size: 0.9rem;
            color: var(--primary-color);
        }

        .social-links {
            display: flex;
            gap: 20px;
            margin-top: 25px;
        }

        .social-link {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            transition: var(--transition);
            color: var(--text-color);
            font-size: 1.2rem;
            box-shadow: var(--shadow);
        }

        .social-link:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-5px);
        }

        .footer-contact p {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--light-text);
        }

        .footer-contact p i {
            color: var(--primary-color);
            font-size: 1.2rem;
            min-width: 25px;
        }

        .copyright {
            text-align: center;
            margin-top: 60px;
            padding-top: 25px;
            border-top: var(--border);
            color: var(--light-text);
        }

        /* سلة التسوق العائمة المحسنة */
        .floating-cart {
            position: fixed;
            bottom: 40px;
            left: 40px;
            background: var(--primary-color);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 999;
            transition: var(--transition);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            box-shadow: 0 10px 30px rgba(0, 179, 0, 0.4);
        }

        .floating-cart:hover {
            transform: scale(1.1) translateY(-5px);
            background: var(--primary-dark);
            box-shadow: 0 15px 40px rgba(0, 179, 0, 0.5);
        }

        .floating-cart i {
            font-size: 1.5rem;
        }

        .floating-cart .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        /* نافذة السلة المحسنة */
        .cart-modal {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: flex-end;
            align-items: flex-start;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .cart-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .cart-content {
            width: 100%;
            max-width: 500px;
            height: 100%;
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-left: var(--border);
            overflow-y: auto;
            padding: 25px;
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform: translateX(100%);
            box-shadow: -10px 0 50px rgba(0, 0, 0, 0.3);
        }

        .cart-modal.show .cart-content {
            transform: translateX(0);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: var(--border);
        }

        .cart-title {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-title i {
            color: var(--primary-color);
        }

        .close-cart {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--light-text);
            transition: var(--transition);
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        .close-cart:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        .cart-items {
            margin-bottom: 25px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 20px 0;
            border-bottom: var(--border);
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            object-fit: cover;
            margin-left: 20px;
            border: var(--border);
            transition: var(--transition);
        }

        .cart-item:hover .cart-item-image {
            transform: scale(1.05);
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .cart-item-price {
            color: var(--primary-color);
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            color: var(--text-color);
            font-weight: bold;
            transition: var(--transition);
        }

        .quantity-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .quantity-value {
            margin: 0 15px;
            min-width: 20px;
            text-align: center;
        }

        .remove-item {
            background: none;
            border: none;
            color: #ff4d4d;
            cursor: pointer;
            font-size: 1.5rem;
            margin-right: 15px;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        .remove-item:hover {
            background: rgba(255, 0, 0, 0.1);
            transform: scale(1.1);
        }

        .cart-summary {
            margin-top: 30px;
            padding-top: 25px;
            border-top: var(--border);
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            font-weight: bold;
            font-size: 1.4rem;
        }

        .checkout-form {
            margin-top: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--light-text);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 14px 18px;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            border-radius: 8px;
            color: var(--text-color);
            font-family: 'Tajawal', Arial, sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 0 3px rgba(0, 179, 0, 0.2);
        }

        .checkout-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0, 179, 0, 0.3);
        }

        .checkout-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 179, 0, 0.4);
        }

        .empty-cart {
            text-align: center;
            padding: 60px 0;
            color: var(--light-text);
        }

        .empty-cart i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: var(--light-text);
        }

        .empty-cart h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .empty-cart p {
            font-size: 1.1rem;
            max-width: 300px;
            margin: 0 auto;
        }

        /* رسالة تأكيد الطلب المحسنة */
        .order-confirmation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            border-radius: var(--card-radius);
            padding: 40px;
            max-width: 550px;
            width: 90%;
            text-align: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
        }

        .order-confirmation.show {
            opacity: 1;
            visibility: visible;
        }

        .confirmation-icon {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 25px;
            animation: bounce 1s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-15px); }
        }

        .order-confirmation h3 {
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        .confirmation-message {
            margin-bottom: 30px;
            line-height: 1.8;
            font-size: 1.1rem;
            color: var(--light-text);
        }

        .close-confirmation {
            padding: 14px 35px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(0, 179, 0, 0.3);
        }

        .close-confirmation:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 179, 0, 0.4);
        }

        /* نافذة تسجيل الدخول */
        .auth-modal {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .auth-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .auth-content {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--card-radius);
            padding: 40px;
            position: relative;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            transform: translateY(20px);
            transition: all 0.4s;
        }

        .auth-modal.show .auth-content {
            transform: translateY(0);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-title {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .auth-subtitle {
            color: var(--light-text);
            font-size: 1.1rem;
        }

        .auth-form .form-group {
            margin-bottom: 25px;
        }

        .auth-form .form-control {
            width: 100%;
            padding: 15px 20px;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            border-radius: 8px;
            color: var(--text-color);
            font-family: 'Tajawal', Arial, sans-serif;
            font-size: 1.1rem;
        }

        .auth-form .form-control:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
        }

        .auth-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .auth-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
        }

        .auth-footer {
            text-align: center;
            margin-top: 30px;
            color: var(--light-text);
        }

        .auth-toggle {
            color: var(--primary-color);
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }

        .auth-toggle:hover {
            text-decoration: underline;
        }

        .close-auth {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--light-text);
            transition: var(--transition);
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        .close-auth:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        /* صفحة تفاصيل المنتج */
        .product-detail-modal {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .product-detail-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .product-detail-content {
            width: 100%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--card-radius);
            padding: 40px;
            position: relative;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            transform: translateY(20px);
            transition: all 0.4s;
        }

        .product-detail-modal.show .product-detail-content {
            transform: translateY(0);
        }

        .close-detail {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--light-text);
            transition: var(--transition);
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        .close-detail:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        .product-detail-container {
            display: flex;
            gap: 40px;
        }

        .product-detail-images {
            flex: 1;
            min-width: 300px;
        }

        .main-image-container {
            width: 100%;
            height: 400px;
            border-radius: var(--card-radius);
            overflow: hidden;
            margin-bottom: 20px;
            border: var(--border);
        }

        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .thumbnail-container {
            display: flex;
            gap: 15px;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
            cursor: pointer;
            border: var(--border);
            transition: var(--transition);
        }

        .thumbnail:hover, .thumbnail.active {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .product-detail-info {
            flex: 1;
        }

        .product-detail-title {
            font-size: 2.2rem;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .product-detail-meta {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .product-detail-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--accent-color);
        }

        .product-detail-reviews {
            color: var(--light-text);
            font-size: 0.95rem;
        }

        .product-detail-price {
            font-size: 2rem;
            font-weight: bold;
            margin: 25px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .product-detail-original-price {
            font-size: 1.5rem;
            color: var(--light-text);
            text-decoration: line-through;
        }

        .product-detail-description {
            margin: 30px 0;
            line-height: 1.8;
            color: var(--light-text);
        }

        .product-detail-actions {
            display: flex;
            gap: 15px;
            margin-top: 35px;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 25px 0;
        }

        .quantity-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            cursor: pointer;
            color: var(--text-color);
            font-weight: bold;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .quantity-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .quantity-value {
            font-size: 1.3rem;
            min-width: 30px;
            text-align: center;
        }

        .add-to-cart-detail {
            padding: 15px 35px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 179, 0, 0.3);
        }

        .add-to-cart-detail:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 179, 0, 0.4);
        }

        .wishlist-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            cursor: pointer;
            color: var(--text-color);
            font-size: 1.3rem;
            transition: var(--transition);
        }

        .wishlist-btn:hover, .wishlist-btn.active {
            color: #ff4d4d;
            transform: scale(1.1);
        }

        .product-detail-specs {
            margin-top: 40px;
        }

        .specs-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }

        .specs-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 0;
            width: 50px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        .specs-table {
            width: 100%;
            border-collapse: collapse;
        }

        .specs-table tr {
            border-bottom: var(--border);
        }

        .specs-table tr:last-child {
            border-bottom: none;
        }

        .specs-table td {
            padding: 15px 0;
        }

        .specs-label {
            color: var(--light-text);
            font-weight: 500;
            min-width: 150px;
            display: inline-block;
        }

        /* خريطة تحديد الموقع */
        .map-container {
            width: 100%;
            height: 300px;
            border-radius: var(--card-radius);
            overflow: hidden;
            margin: 25px 0;
            border: var(--border);
        }

        #addressMap {
            width: 100%;
            height: 100%;
        }

        .location-btn {
            padding: 12px 25px;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
            color: var(--text-color);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .location-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        /* نافذة سياسات الخدمة */
        .policy-modal {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .policy-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .policy-content {
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--card-radius);
            padding: 40px;
            position: relative;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            transform: translateY(20px);
            transition: all 0.4s;
        }

        .policy-modal.show .policy-content {
            transform: translateY(0);
        }

        .close-policy {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--light-text);
            transition: var(--transition);
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
        }

        .close-policy:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        .policy-title {
            font-size: 2rem;
            margin-bottom: 25px;
            text-align: center;
            color: var(--primary-color);
        }

        .policy-text {
            line-height: 1.8;
            margin-bottom: 20px;
            color: var(--light-text);
        }

        .policy-section {
            margin-bottom: 30px;
        }

        .policy-section h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--text-color);
            position: relative;
            padding-right: 15px;
        }

        .policy-section h3::after {
            content: '';
            position: absolute;
            bottom: -8px;
            right: 0;
            width: 50px;
            height: 3px;
            background: var(--primary-color);
            border-radius: 2px;
        }

        /* قسم التعليقات والتقييمات */
        .reviews-section {
            margin-top: 50px;
            padding-top: 30px;
            border-top: var(--border);
        }

        .review-form {
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--card-radius);
            padding: 25px;
            margin-bottom: 30px;
            border: var(--border);
        }

        .review-form h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .rating-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            direction: ltr;
        }

        .rating-input i {
            font-size: 1.5rem;
            color: var(--light-text);
            cursor: pointer;
            transition: var(--transition);
        }

        .rating-input i.active {
            color: var(--accent-color);
        }

        .review-textarea {
            width: 100%;
            padding: 15px;
            background: var(--bg-color);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border: var(--border);
            border-radius: 8px;
            color: var(--text-color);
            font-family: 'Tajawal', Arial, sans-serif;
            font-size: 1rem;
            margin-bottom: 15px;
            min-height: 100px;
            resize: vertical;
        }

        .submit-review {
            padding: 12px 25px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
        }

        .submit-review:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
        }

        .reviews-list {
            margin-top: 30px;
        }

        .review-item {
            background: var(--card-bg);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
            border-radius: var(--card-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: var(--border);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .review-user {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }

        .user-name {
            font-weight: bold;
        }

        .review-date {
            color: var(--light-text);
            font-size: 0.9rem;
        }

        .review-rating {
            color: var(--accent-color);
            direction: ltr;
        }

        .review-content {
            line-height: 1.6;
            color: var(--light-text);
        }

        /* التكيف مع الشاشات الصغيرة */
        @media (max-width: 1200px) {
            .product-detail-container {
                flex-direction: column;
            }
            
            .product-detail-images {
                display: flex;
                gap: 20px;
            }
            
            .main-image-container {
                flex: 1;
                height: 350px;
            }
            
            .thumbnail-container {
                flex-direction: column;
            }
        }

        @media (max-width: 992px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .section-title {
                font-size: 2.2rem;
            }
            
            .product-detail-title {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 0 20px;
            }
            
            .logo {
                font-size: 1.6rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .hero {
                flex-direction: column;
                height: auto;
            }
            
            .hero-content {
                order: 2;
                padding: 40px 30px;
            }
            
            .hero-image {
                order: 1;
                height: 300px;
            }
            
            .hero-buttons {
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 25px;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-container {
                min-width: 100%;
            }
            
            .category-filter {
                justify-content: center;
            }
            
            .product-detail-images {
                flex-direction: column;
            }
            
            .thumbnail-container {
                flex-direction: row;
            }
            
            .product-detail-actions {
                flex-direction: column;
            }
            
            .add-to-cart-detail {
                justify-content: center;
            }
            
            .policy-content {
                padding: 30px 20px;
            }
        }

        @media (max-width: 576px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .hero-btn {
                width: 100%;
                justify-content: center;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .product-card {
                max-width: 100%;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
            
            .product-detail-content {
                padding: 30px 20px;
            }
            
            .product-detail-title {
                font-size: 1.8rem;
            }
            
            .product-detail-price {
                font-size: 1.8rem;
            }
            
            .main-image-container {
                height: 250px;
            }
            
            .policy-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- شريط التنقل المحسن -->
    <nav class="navbar">
        <a href="index.html" class="logo">
            سوبرماكس
            <i class="fas fa-shopping-basket"></i>
        </a>
        
        <ul class="nav-links">
            <li><a href="index.html" class="active"><i class="fas fa-home"></i> الرئيسية</a></li>
            <li><a href="products.html"><i class="fas fa-box-open"></i> المنتجات</a></li>
            <li><a href="offers.html"><i class="fas fa-tag"></i> العروض</a></li>
            <li><a href="about.html"><i class="fas fa-info-circle"></i> من نحن</a></li>
            <li><a href="contact.html"><i class="fas fa-phone-alt"></i> اتصل بنا</a></li>
        </ul>
        
        <div class="nav-icons">
            <div class="nav-icon" id="searchIcon">
                <i class="fas fa-search"></i>
            </div>
            <div class="nav-icon" id="userIcon">
                <i class="fas fa-user"></i>
            </div>
            <div class="nav-icon" id="cartIcon">
                <i class="fas fa-shopping-cart"></i>
                <span class="badge" id="cartCount">0</span>
            </div>
        </div>
    </nav>

    <!-- المحتوى الرئيسي المحسن -->
    <div class="container">
        <!-- قسم الهيرو المحسن -->
        <section class="hero">
            <div class="hero-content">
                <h1>أحدث المنتجات بأسعار مميزة</h1>
                <p>اكتشف تشكيلتنا الواسعة من المنتجات عالية الجودة التي تلبي جميع احتياجاتك اليومية بأسعار تنافسية وخصومات حصرية.</p>
                <div class="hero-buttons">
                    <button class="hero-btn" id="shopNowBtn">
                        <i class="fas fa-shopping-cart"></i> تسوق الآن
                    </button>
                    <button class="hero-btn secondary" id="viewOffersBtn">
                        <i class="fas fa-tag"></i> تصفح العروض
                    </button>
                </div>
            </div>
            <div class="hero-image"></div>
        </section>

        <!-- قسم الأقسام -->
        <section>
            <div class="section-header">
                <h2 class="section-title">تصفح حسب الأقسام</h2>
                <a href="products.html" class="section-link">
                    عرض الكل
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            
            <div class="category-filter" id="categoryFilter">
                <!-- سيتم إضافة الأقسام ديناميكيًا -->
            </div>
        </section>

        <!-- قسم جميع المنتجات -->
        <section>
            <div class="section-header">
                <h2 class="section-title">جميع المنتجات</h2>
                <a href="products.html" class="section-link">
                    عرض الكل
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            
            <div class="products-grid" id="allProducts">
                <!-- سيتم إضافة جميع المنتجات هنا -->
            </div>
        </section>
    </div>

    <!-- التذييل المحسن -->
    <footer>
        <div class="footer-content">
            <div class="footer-column">
                <h3>متجر سوبرماكس</h3>
                <p>نقدم لكم أفضل المنتجات بجودة عالية وأسعار تنافسية لتلبية جميع احتياجاتكم اليومية مع خدمة توصيل سريعة وموثوقة.</p>
                <div class="social-links">
                    <a href="#" class="social-link"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-tiktok"></i></a>
                    <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            
            <div class="footer-column">
                <h3>خدمة العملاء</h3>
                <ul class="footer-links">
                    <li><a href="#" id="faqLink"><i class="fas fa-question-circle"></i> الأسئلة الشائعة</a></li>
                    <li><a href="#" id="returnPolicyLink"><i class="fas fa-exchange-alt"></i> سياسة الإرجاع</a></li>
                    <li><a href="#" id="shippingPolicyLink"><i class="fas fa-truck"></i> سياسة الشحن</a></li>
                    <li><a href="#" id="privacyPolicyLink"><i class="fas fa-lock"></i> سياسة الخصوصية</a></li>
                    <li><a href="#" id="termsLink"><i class="fas fa-file-alt"></i> الشروط والأحكام</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>اتصل بنا</h3>
                <div class="footer-contact">
                    <p><i class="fas fa-map-marker-alt"></i> بغداد، كرادة خارج مجمع عبدالرسول علي</p>
                    <p><i class="fas fa-phone"></i> 07711272744</p>
                    <p><i class="fas fa-envelope"></i> info@supermax.com</p>
                    <p><i class="fas fa-clock"></i> من السبت إلى الخميس: 9ص - 5م</p>
                </div>
            </div>
        </div>
        
        <div class="copyright">
            <p>جميع الحقوق محفوظة &copy; 2023 متجر سوبرماكس</p>
        </div>
    </footer>

    <!-- سلة التسوق العائمة المحسنة -->
    <div class="floating-cart" id="floatingCart">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="floatingCartCount">0</span>
    </div>

    <!-- نافذة السلة المحسنة -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-content">
            <div class="cart-header">
                <h3 class="cart-title"><i class="fas fa-shopping-cart"></i> سلة التسوق</h3>
                <button class="close-cart" id="closeCart">&times;</button>
            </div>
            
            <div class="cart-items" id="cartItemsContainer">
                <!-- سيتم ملء المحتوى هنا ديناميكيًا -->
            </div>
            
            <div class="cart-summary">
                <div class="cart-total">
                    <span>المجموع:</span>
                    <span id="cartTotalPrice">0 دينار</span>
                </div>
                
                <form class="checkout-form" id="checkoutForm">
                    <div class="form-group">
                        <label for="customerName">الاسم الكامل</label>
                        <input type="text" id="customerName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="customerPhone">رقم الهاتف</label>
                        <input type="tel" id="customerPhone" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label>العنوان</label>
                        <button type="button" class="location-btn" id="detectLocationBtn">
                            <i class="fas fa-map-marker-alt"></i> تحديد الموقع على الخريطة
                        </button>
                        <div class="map-container">
                            <div id="addressMap"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="customerNotes">ملاحظات (اختياري)</label>
                        <textarea id="customerNotes" class="form-control" rows="2"></textarea>
                    </div>
                    
                    <button type="submit" class="checkout-btn">
                        <i class="fas fa-check-circle"></i> تأكيد الطلب
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- رسالة تأكيد الطلب المحسنة -->
    <div class="order-confirmation" id="orderConfirmation">
        <div class="confirmation-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h3>شكراً لطلبك!</h3>
        <p class="confirmation-message">تم استلام طلبك بنجاح وسيتم التواصل معك قريباً لتأكيد التفاصيل وتحديد موعد التوصيل. يمكنك تتبع حالة طلبك من خلال حسابك.</p>
        <button class="close-confirmation" id="closeConfirmation">حسناً</button>
    </div>

    <!-- نافذة تسجيل الدخول -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <button class="close-auth" id="closeAuth">&times;</button>
            <div class="auth-header">
                <h3 class="auth-title" id="authTitle">تسجيل الدخول</h3>
                <p class="auth-subtitle" id="authSubtitle">ادخل بياناتك للوصول إلى حسابك</p>
            </div>
            
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">البريد الإلكتروني</label>
                    <input type="email" id="loginEmail" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">كلمة المرور</label>
                    <input type="password" id="loginPassword" class="form-control" required>
                </div>
                
                <button type="submit" class="auth-btn">تسجيل الدخول</button>
                
                <div class="auth-footer">
                    <p>ليس لديك حساب؟ <span class="auth-toggle" id="showRegister">سجل الآن</span></p>
                </div>
            </form>
            
            <form class="auth-form" id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="registerName">الاسم الكامل</label>
                    <input type="text" id="registerName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="registerEmail">البريد الإلكتروني</label>
                    <input type="email" id="registerEmail" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPhone">رقم الهاتف</label>
                    <input type="tel" id="registerPhone" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="registerPassword">كلمة المرور</label>
                    <input type="password" id="registerPassword" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="registerConfirmPassword">تأكيد كلمة المرور</label>
                    <input type="password" id="registerConfirmPassword" class="form-control" required>
                </div>
                
                <button type="submit" class="auth-btn">تسجيل حساب جديد</button>
                
                <div class="auth-footer">
                    <p>لديك حساب بالفعل؟ <span class="auth-toggle" id="showLogin">تسجيل الدخول</span></p>
                </div>
            </form>
        </div>
    </div>

    <!-- صفحة تفاصيل المنتج -->
    <div class="product-detail-modal" id="productDetailModal">
        <div class="product-detail-content">
            <button class="close-detail" id="closeDetail">&times;</button>
            <div class="product-detail-container">
                <div class="product-detail-images">
                    <div class="main-image-container">
                        <img src="" alt="صورة المنتج" class="main-image" id="mainProductImage">
                    </div>
                    <div class="thumbnail-container" id="productThumbnails">
                        <!-- سيتم إضافة الصور المصغرة هنا -->
                    </div>
                </div>
                
                <div class="product-detail-info">
                    <h1 class="product-detail-title" id="productDetailTitle"></h1>
                    
                    <div class="product-detail-meta">
                        <div class="product-detail-rating">
                            <!-- سيتم إضافة النجوم حسب التقييم -->
                        </div>
                        <span class="product-detail-reviews" id="productReviewsCount"></span>
                    </div>
                    
                    <div class="product-detail-price">
                        <span id="productDetailPrice"></span>
                        <span class="product-detail-original-price" id="productDetailOriginalPrice"></span>
                    </div>
                    
                    <div class="product-detail-description" id="productDetailDescription"></div>
                    
                    <div class="quantity-selector">
                        <button class="quantity-btn minus" id="decreaseQuantity">-</button>
                        <span class="quantity-value" id="productQuantity">1</span>
                        <button class="quantity-btn plus" id="increaseQuantity">+</button>
                    </div>
                    
                    <div class="product-detail-actions">
                        <button class="add-to-cart-detail" id="addToCartDetail">
                            <i class="fas fa-shopping-cart"></i> أضف إلى السلة
                        </button>
                        <button class="wishlist-btn" id="wishlistBtn">
                            <i class="far fa-heart"></i>
                        </button>
                    </div>
                    
                    <div class="product-detail-specs">
                        <h3 class="specs-title">مواصفات المنتج</h3>
                        <table class="specs-table" id="productSpecs">
                            <!-- سيتم إضافة المواصفات هنا -->
                        </table>
                    </div>
                    
                    <!-- قسم التقييمات والتعليقات -->
                    <div class="reviews-section">
                        <h3 class="specs-title">التقييمات والتعليقات</h3>
                        
                        <div class="review-form">
                            <h3>أضف تقييمك</h3>
                            <div class="rating-input" id="ratingInput">
                                <i class="fas fa-star" data-rating="1"></i>
                                <i class="fas fa-star" data-rating="2"></i>
                                <i class="fas fa-star" data-rating="3"></i>
                                <i class="fas fa-star" data-rating="4"></i>
                                <i class="fas fa-star" data-rating="5"></i>
                            </div>
                            <textarea class="review-textarea" id="reviewText" placeholder="شاركنا رأيك عن المنتج..."></textarea>
                            <button class="submit-review" id="submitReview">إرسال التقييم</button>
                        </div>
                        
                        <div class="reviews-list" id="reviewsList">
                            <!-- سيتم إضافة التقييمات هنا -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة سياسات الخدمة -->
    <div class="policy-modal" id="policyModal">
        <div class="policy-content">
            <button class="close-policy" id="closePolicy">&times;</button>
            <h2 class="policy-title" id="policyTitle">سياسة الخدمة</h2>
            
            <div id="policyContent">
                <!-- سيتم تعبئة المحتوى هنا ديناميكيًا -->
            </div>
        </div>
    </div>

    <!-- مكتبات JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { getDatabase, ref, onValue, push, set, update } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyADaBoLHAzuhsF_PffLp31hnkp0cmTK-18",
            authDomain: "supermax-c14fd.firebaseapp.com",
            databaseURL: "https://supermax-c14fd-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "supermax-c14fd",
            storageBucket: "supermax-c14fd.appspot.com",
            messagingSenderId: "872444131439",
            appId: "1:872444131439:web:50bc31dbdd13be4c99f59a",
            measurementId: "G-5YZBXNW2Z5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // متغيرات التطبيق
        let allProducts = [];
        let categories = new Set(['all']);
        let cartItems = [];
        let currentUser = null;
        let map;
        let userMarker;
        let selectedProduct = null;
        let productQuantity = 1;
        let selectedRating = 0;

        // عناصر DOM
        const allProductsContainer = document.getElementById('allProducts');
        const categoryFilter = document.getElementById('categoryFilter');
        const cartCount = document.getElementById('cartCount');
        const floatingCart = document.getElementById('floatingCart');
        const floatingCartCount = document.getElementById('floatingCartCount');
        const cartIcon = document.getElementById('cartIcon');
        const cartModal = document.getElementById('cartModal');
        const closeCart = document.getElementById('closeCart');
        const cartItemsContainer = document.getElementById('cartItemsContainer');
        const cartTotalPrice = document.getElementById('cartTotalPrice');
        const checkoutForm = document.getElementById('checkoutForm');
        const orderConfirmation = document.getElementById('orderConfirmation');
        const closeConfirmation = document.getElementById('closeConfirmation');
        const shopNowBtn = document.getElementById('shopNowBtn');
        const viewOffersBtn = document.getElementById('viewOffersBtn');
        const authModal = document.getElementById('authModal');
        const closeAuth = document.getElementById('closeAuth');
        const authTitle = document.getElementById('authTitle');
        const authSubtitle = document.getElementById('authSubtitle');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        const userIcon = document.getElementById('userIcon');
        const productDetailModal = document.getElementById('productDetailModal');
        const closeDetail = document.getElementById('closeDetail');
        const mainProductImage = document.getElementById('mainProductImage');
        const productThumbnails = document.getElementById('productThumbnails');
        const productDetailTitle = document.getElementById('productDetailTitle');
        const productDetailPrice = document.getElementById('productDetailPrice');
        const productDetailOriginalPrice = document.getElementById('productDetailOriginalPrice');
        const productDetailDescription = document.getElementById('productDetailDescription');
        const productSpecs = document.getElementById('productSpecs');
        const decreaseQuantity = document.getElementById('decreaseQuantity');
        const increaseQuantity = document.getElementById('increaseQuantity');
        const productQuantityEl = document.getElementById('productQuantity');
        const addToCartDetail = document.getElementById('addToCartDetail');
        const wishlistBtn = document.getElementById('wishlistBtn');
        const detectLocationBtn = document.getElementById('detectLocationBtn');
        const addressMap = document.getElementById('addressMap');
        const productReviewsCount = document.getElementById('productReviewsCount');
        const ratingInput = document.getElementById('ratingInput');
        const reviewText = document.getElementById('reviewText');
        const submitReview = document.getElementById('submitReview');
        const reviewsList = document.getElementById('reviewsList');
        const policyModal = document.getElementById('policyModal');
        const closePolicy = document.getElementById('closePolicy');
        const policyTitle = document.getElementById('policyTitle');
        const policyContent = document.getElementById('policyContent');
        const faqLink = document.getElementById('faqLink');
        const returnPolicyLink = document.getElementById('returnPolicyLink');
        const shippingPolicyLink = document.getElementById('shippingPolicyLink');
        const privacyPolicyLink = document.getElementById('privacyPolicyLink');
        const termsLink = document.getElementById('termsLink');

        // سياسات الخدمة
        const policies = {
            faq: {
                title: "الأسئلة الشائعة",
                content: `
                    <div class="policy-section">
                        <h3>كيفية الطلب</h3>
                        <p class="policy-text">
                            1. اختر المنتجات التي ترغب في شرائها وأضفها إلى سلة التسوق.<br>
                            2. انتقل إلى سلة التسوق واطلع على تفاصيل طلبك.<br>
                            3. املأ معلومات التوصيل والدفع.<br>
                            4. تأكيد الطلب وانتظار رسالة التأكيد.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>طرق الدفع</h3>
                        <p class="policy-text">
                            نقبل الدفع نقداً عند الاستلام أو عبر البطاقات الائتمانية. 
                            جميع عمليات الدفع الإلكترونية تتم عبر بوابات دفع آمنة ومشفرة.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>مدة التوصيل</h3>
                        <p class="policy-text">
                            تتراوح مدة التوصيل بين 1-3 أيام عمل داخل المدينة، و3-7 أيام للمدن الأخرى.
                            قد تختلف المدة حسب المنطقة والظروف الجوية.
                        </p>
                    </div>
                `
            },
            returnPolicy: {
                title: "سياسة الإرجاع والاستبدال",
                content: `
                    <div class="policy-section">
                        <h3>شروط الإرجاع</h3>
                        <p class="policy-text">
                            - يمكنك إرجاع المنتج خلال 14 يومًا من تاريخ الاستلام.<br>
                            - يجب أن يكون المنتج في حالته الأصلية وبعبواته الأصلية.<br>
                            - لا يمكن إرجاع المنتجات المستهلكة أو التالفة بسبب سوء الاستخدام.<br>
                            - يجب تقديم فاتورة الشراء عند إرجاع المنتج.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>إجراءات الإرجاع</h3>
                        <p class="policy-text">
                            1. اتصل بخدمة العملاء للإبلاغ عن رغبتك في الإرجاع.<br>
                            2. سنقوم بتحديد موعد لاستلام المنتج من عنوانك.<br>
                            3. بعد فحص المنتج، سيتم اعتماد الإرجاع أو الاستبدال.<br>
                            4. سيتم إعادة المبلغ خلال 3-5 أيام عمل من تاريخ اعتماد الإرجاع.
                        </p>
                    </div>
                `
            },
            shippingPolicy: {
                title: "سياسة الشحن والتوصيل",
                content: `
                    <div class="policy-section">
                        <h3>مناطق التوصيل</h3>
                        <p class="policy-text">
                            نقوم بالتوصيل لجميع مناطق المدينة وأحيائها. 
                            بالنسبة للمدن الأخرى، يرجى التأكد من توفر خدمة التوصيل في منطقتك قبل إتمام الطلب.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>تكلفة التوصيل</h3>
                        <p class="policy-text">
                            - توصيل مجاني للطلبات فوق 50,000 دينار داخل المدينة.<br>
                            - تكلفة التوصيل 5,000 دينار للطلبات الأقل من 50,000 دينار.<br>
                            - تكلفة التوصيل للمدن الأخرى تبدأ من 10,000 دينار حسب المنطقة.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>تتبع الشحنة</h3>
                        <p class="policy-text">
                            بعد تأكيد الطلب، سيتم إرسال رقم تتبع الشحنة إلى بريدك الإلكتروني ورقم هاتفك.
                            يمكنك استخدام هذا الرقم لتتبع حالة شحنتك عبر موقعنا أو عبر تطبيق التوصيل.
                        </p>
                    </div>
                `
            },
            privacyPolicy: {
                title: "سياسة الخصوصية",
                content: `
                    <div class="policy-section">
                        <h3>جمع المعلومات</h3>
                        <p class="policy-text">
                            نجمع المعلومات التي تزودنا بها عند التسجيل أو الشراء أو الاشتراك في النشرة البريدية.
                            قد تشمل هذه المعلومات اسمك، عنوانك، بريدك الإلكتروني، ورقم هاتفك.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>استخدام المعلومات</h3>
                        <p class="policy-text">
                            نستخدم المعلومات التي نجمعها لمعالجة طلباتك، تحسين تجربة التسوق لديك، 
                            وإرسال تحديثات وعروض خاصة قد تهمك. نحن لا نبيع أو نشارك معلوماتك مع أطراف ثالثة.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>حماية المعلومات</h3>
                        <p class="policy-text">
                            نستخدم تقنيات تشفير متقدمة لحماية معلوماتك الشخصية أثناء نقلها وتخزينها.
                            ومع ذلك، لا يمكن ضمان أمان كامل لأي طريقة نقل عبر الإنترنت أو تخزين إلكتروني.
                        </p>
                    </div>
                `
            },
            terms: {
                title: "الشروط والأحكام",
                content: `
                    <div class="policy-section">
                        <h3>شروط الاستخدام</h3>
                        <p class="policy-text">
                            باستخدامك لهذا الموقع، فإنك توافق على الالتزام بهذه الشروط والأحكام.
                            نحن نحتفظ بالحق في تعديل هذه الشروط في أي وقت دون إشعار مسبق.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>الملكية الفكرية</h3>
                        <p class="policy-text">
                            جميع المحتويات الموجودة على هذا الموقع، بما في ذلك النصوص والصور والشعارات،
                            هي ملك لنا أو للموردين لدينا ومحمية بقوانين الملكية الفكرية.
                        </p>
                    </div>
                    
                    <div class="policy-section">
                        <h3>الضمان والمسؤولية</h3>
                        <p class="policy-text">
                            نحن نضمن جودة المنتجات المباعة ونقدم ضمانًا ضد عيوب التصنيع.
                            ومع ذلك، نحن لسنا مسؤولين عن الأضرار الناتجة عن سوء الاستخدام أو التعديلات على المنتج.
                        </p>
                    </div>
                `
            }
        };

        // تحميل بيانات السلة من localStorage
        const loadCart = () => {
            const savedCart = localStorage.getItem('supermax-cart');
            
            if (savedCart) {
                cartItems = JSON.parse(savedCart);
                updateCartCount();
                renderCartItems();
            }
        };

        // حفظ السلة في localStorage
        const saveCart = () => {
            localStorage.setItem('supermax-cart', JSON.stringify(cartItems));
        };

        // تحديث عداد السلة
        const updateCartCount = () => {
            const count = cartItems.reduce((total, item) => total + item.quantity, 0);
            cartCount.textContent = count;
            floatingCartCount.textContent = count;
            saveCart();
        };

        // عرض عناصر السلة
        const renderCartItems = () => {
            cartItemsContainer.innerHTML = '';
            
            if (cartItems.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>سلة التسوق فارغة</h3>
                        <p>ابدأ بإضافة بعض المنتجات إلى سلة التسوق</p>
                    </div>
                `;
                cartTotalPrice.textContent = '0 دينار';
                return;
            }
            
            let total = 0;
            
            cartItems.forEach(item => {
                const product = allProducts.find(p => p.id === item.id) || item;
                total += product.price * item.quantity;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <button class="remove-item" data-id="${item.id}">&times;</button>
                    <img src="${product.coverImage || 'https://via.placeholder.com/80'}" alt="${product.name}" class="cart-item-image">
                    <div class="cart-item-details">
                        <div class="cart-item-name">${product.name}</div>
                        <div class="cart-item-price">${product.price} دينار</div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn minus" data-id="${item.id}">-</button>
                            <span class="quantity-value">${item.quantity}</span>
                            <button class="quantity-btn plus" data-id="${item.id}">+</button>
                        </div>
                    </div>
                `;
                
                cartItemsContainer.appendChild(cartItem);
            });
            
            cartTotalPrice.textContent = `${total} دينار`;
            
            // إضافة معالجات الأحداث للأزرار الجديدة
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = btn.dataset.id;
                    removeFromCart(productId);
                });
            });
            
            document.querySelectorAll('.quantity-btn.minus').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = btn.dataset.id;
                    updateCartItemQuantity(productId, -1);
                });
            });
            
            document.querySelectorAll('.quantity-btn.plus').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = btn.dataset.id;
                    updateCartItemQuantity(productId, 1);
                });
            });
        };

        // إزالة من السلة
        const removeFromCart = (productId) => {
            cartItems = cartItems.filter(item => item.id !== productId);
            updateCartCount();
            renderCartItems();
        };

        // تحديث كمية المنتج في السلة
        const updateCartItemQuantity = (productId, change) => {
            const item = cartItems.find(item => item.id === productId);
            if (!item) return;
            
            item.quantity += change;
            
            if (item.quantity <= 0) {
                removeFromCart(productId);
            } else {
                updateCartCount();
                renderCartItems();
            }
        };

        // عرض جميع المنتجات
        const renderAllProducts = () => {
            allProductsContainer.innerHTML = '';
            
            allProducts.forEach(product => {
                renderProductCard(product, allProductsContainer);
            });
        };

        // عرض بطاقة المنتج
        const renderProductCard = (product, container) => {
            const productCard = document.createElement('div');
            productCard.className = 'product-card';
            productCard.dataset.id = product.id;
            
            let badge = '';
            if (product.isNew) {
                badge = '<span class="product-badge new-badge">جديد</span>';
            } else if (product.discount) {
                badge = `<span class="product-badge discount-badge">خصم ${product.discount}%</span>`;
            }
            
            let originalPrice = '';
            if (product.originalPrice) {
                originalPrice = `<span class="original-price">${product.originalPrice} دينار</span>`;
            }
            
            // حساب متوسط التقييم
            const averageRating = product.reviews ? 
                (product.reviews.reduce((sum, review) => sum + review.rating, 0) / product.reviews.length) : 0;
            
            productCard.innerHTML = `
                ${badge}
                <div class="product-image-container">
                    <img src="${product.coverImage || 'https://via.placeholder.com/300'}" alt="${product.name}" class="product-image">
                </div>
                <h3 class="product-name">${product.name}</h3>
                <div class="product-rating">
                    ${renderRatingStars(averageRating)}
                </div>
                <div class="product-price">
                    <span class="current-price">${product.price} دينار</span>
                    ${originalPrice}
                </div>
                <div class="product-actions">
                    <button class="action-btn quick-view-btn" data-id="${product.id}">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn add-to-cart" data-id="${product.id}">
                        <i class="fas fa-shopping-cart"></i>
                        أضف للسلة
                    </button>
                </div>
            `;
            
            container.appendChild(productCard);
            
            // إضافة معالجات الأحداث
            productCard.querySelector('.add-to-cart').addEventListener('click', (e) => {
                e.stopPropagation();
                addToCart(product.id);
            });
            
            productCard.querySelector('.quick-view-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                showProductDetail(product.id);
            });
            
            productCard.addEventListener('click', () => {
                showProductDetail(product.id);
            });
        };

        // عرض نجوم التقييم
        const renderRatingStars = (rating) => {
            let stars = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            
            return stars;
        };

        // إضافة إلى السلة
        const addToCart = (productId, quantity = 1) => {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cartItems.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cartItems.push({
                    id: productId,
                    name: product.name,
                    price: product.price,
                    coverImage: product.coverImage,
                    quantity: quantity
                });
            }
            
            updateCartCount();
            renderCartItems();
            
            // عرض تأكيد الإضافة
            showAlert(`تمت إضافة ${product.name} إلى سلة التسوق`);
        };

        // عرض تفاصيل المنتج
        const showProductDetail = (productId) => {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;
            
            selectedProduct = product;
            productQuantity = 1;
            selectedRating = 0;
            
            // تعبئة بيانات المنتج
            productDetailTitle.textContent = product.name;
            productDetailPrice.textContent = `${product.price} دينار`;
            
            if (product.originalPrice) {
                productDetailOriginalPrice.textContent = `${product.originalPrice} دينار`;
                productDetailOriginalPrice.style.display = 'inline-block';
            } else {
                productDetailOriginalPrice.style.display = 'none';
            }
            
            productDetailDescription.textContent = product.description || 'لا يوجد وصف متوفر لهذا المنتج';
            
            // تعبئة الصور
            mainProductImage.src = product.coverImage || 'https://via.placeholder.com/500';
            productThumbnails.innerHTML = '';
            
            if (product.images && product.images.length > 0) {
                product.images.forEach((image, index) => {
                    const thumbnail = document.createElement('img');
                    thumbnail.src = image;
                    thumbnail.alt = `صورة ${product.name} ${index + 1}`;
                    thumbnail.className = 'thumbnail';
                    if (index === 0) thumbnail.classList.add('active');
                    
                    thumbnail.addEventListener('click', () => {
                        mainProductImage.src = image;
                        document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                        thumbnail.classList.add('active');
                    });
                    
                    productThumbnails.appendChild(thumbnail);
                });
            } else {
                const thumbnail = document.createElement('img');
                thumbnail.src = product.coverImage || 'https://via.placeholder.com/100';
                thumbnail.alt = `صورة ${product.name}`;
                thumbnail.className = 'thumbnail active';
                
                productThumbnails.appendChild(thumbnail);
            }
            
            // تعبئة المواصفات
            productSpecs.innerHTML = '';
            
            if (product.specs) {
                for (const [key, value] of Object.entries(product.specs)) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><span class="specs-label">${key}</span></td>
                        <td>${value}</td>
                    `;
                    productSpecs.appendChild(row);
                }
            } else {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="2" style="text-align: center; color: var(--light-text);">
                        لا توجد مواصفات متاحة لهذا المنتج
                    </td>
                `;
                productSpecs.appendChild(row);
            }
            
            // تعبئة التقييمات
            const reviews = product.reviews || [];
            const averageRating = reviews.length ? 
                (reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length) : 0;
            
            document.querySelector('.product-detail-rating').innerHTML = renderRatingStars(averageRating);
            productReviewsCount.textContent = reviews.length ? `(${reviews.length} تقييم)` : '(لا توجد تقييمات بعد)';
            
            // تعبئة قسم التعليقات
            renderProductReviews(reviews);
            
            // تحديث الكمية
            productQuantityEl.textContent = productQuantity;
            
            // عرض النافذة
            productDetailModal.classList.add('show');
        };

        // عرض تقييمات المنتج
        const renderProductReviews = (reviews) => {
            reviewsList.innerHTML = '';
            
            if (reviews.length === 0) {
                reviewsList.innerHTML = `
                    <div style="text-align: center; color: var(--light-text); padding: 30px 0;">
                        <i class="fas fa-comment-slash" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>لا توجد تقييمات لهذا المنتج بعد. كن أول من يقيم!</p>
                    </div>
                `;
                return;
            }
            
            reviews.forEach(review => {
                const reviewItem = document.createElement('div');
                reviewItem.className = 'review-item';
                reviewItem.innerHTML = `
                    <div class="review-header">
                        <div class="review-user">
                            <img src="${review.userAvatar || 'https://via.placeholder.com/40'}" 
                                 alt="${review.userName}" class="user-avatar-small">
                            <div>
                                <div class="user-name">${review.userName}</div>
                                <div class="review-date">${review.date}</div>
                            </div>
                        </div>
                        <div class="review-rating">
                            ${renderRatingStars(review.rating)}
                        </div>
                    </div>
                    <div class="review-content">
                        ${review.comment}
                    </div>
                `;
                
                reviewsList.appendChild(reviewItem);
            });
        };

        // إدارة الكمية
        const updateQuantity = (change) => {
            productQuantity += change;
            
            if (productQuantity < 1) productQuantity = 1;
            if (productQuantity > 99) productQuantity = 99;
            
            productQuantityEl.textContent = productQuantity;
        };

        // عرض رسالة تنبيه
        const showAlert = (message) => {
            const alert = document.createElement('div');
            alert.className = 'alert';
            alert.innerHTML = `
                <div style="position: fixed; bottom: 20px; left: 20px; background: var(--primary-color); color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 1000; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-check-circle"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 300);
            }, 3000);
        };

        // إرسال الطلب إلى قاعدة البيانات
        const submitOrder = (orderData) => {
            const ordersRef = ref(db, 'orders');
            
            if (currentUser) {
                orderData.userId = currentUser.uid;
            }
            
            push(ordersRef, orderData)
                .then(() => {
                    // إفراغ السلة بعد إرسال الطلب
                    cartItems = [];
                    updateCartCount();
                    renderCartItems();
                    
                    // إظهار رسالة التأكيد
                    orderConfirmation.classList.add('show');
                    
                    // إغلاق نافذة السلة
                    cartModal.classList.remove('show');
                })
                .catch((error) => {
                    console.error('Error submitting order:', error);
                    showAlert('حدث خطأ أثناء إرسال الطلب، يرجى المحاولة مرة أخرى');
                });
        };

        // تسجيل الدخول
        const loginUser = (email, password) => {
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    authModal.classList.remove('show');
                    showAlert(`مرحباً بعودتك، ${currentUser.displayName || 'عزيزي العميل'}`);
                })
                .catch((error) => {
                    console.error('Login error:', error);
                    showAlert('خطأ في تسجيل الدخول: ' + error.message);
                });
        };

        // تسجيل حساب جديد
        const registerUser = (name, email, phone, password) => {
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    
                    // حفظ بيانات المستخدم الإضافية
                    const userRef = ref(db, `users/${currentUser.uid}`);
                    set(userRef, {
                        name: name,
                        email: email,
                        phone: phone,
                        createdAt: new Date().toISOString()
                    });
                    
                    authModal.classList.remove('show');
                    showAlert(`تم إنشاء حسابك بنجاح، مرحباً ${name}`);
                })
                .catch((error) => {
                    console.error('Registration error:', error);
                    showAlert('خطأ في التسجيل: ' + error.message);
                });
        };

        // تسجيل الخروج
        const logoutUser = () => {
            signOut(auth)
                .then(() => {
                    currentUser = null;
                    showAlert('تم تسجيل الخروج بنجاح');
                })
                .catch((error) => {
                    console.error('Logout error:', error);
                    showAlert('حدث خطأ أثناء تسجيل الخروج');
                });
        };

        // تحديد الموقع الجغرافي
        const detectLocation = () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        
                        // تحديث الخريطة
                        if (map) {
                            map.setView([latitude, longitude], 15);
                        } else {
                            initMap(latitude, longitude);
                        }
                        
                        // تحديث العلامة
                        if (userMarker) {
                            userMarker.setLatLng([latitude, longitude]);
                        } else {
                            userMarker = L.marker([latitude, longitude]).addTo(map)
                                .bindPopup('موقعك الحالي')
                                .openPopup();
                        }
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        showAlert('تعذر الحصول على موقعك: ' + error.message);
                    }
                );
            } else {
                showAlert('المتصفح لا يدعم خدمة تحديد الموقع');
            }
        };

        // تهيئة الخريطة
        const initMap = (lat = 33.3128, lng = 44.3615) => {
            map = L.map('addressMap').setView([lat, lng], 15);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            userMarker = L.marker([lat, lng]).addTo(map)
                .bindPopup('موقع التوصيل')
                .openPopup();
            
            map.on('click', (e) => {
                const { lat, lng } = e.latlng;
                
                if (userMarker) {
                    userMarker.setLatLng([lat, lng]);
                } else {
                    userMarker = L.marker([lat, lng]).addTo(map)
                        .bindPopup('موقع التوصيل')
                        .openPopup();
                }
            });
        };

        // جلب البيانات من Firebase
        const fetchData = () => {
            onValue(ref(db, 'products'), (snapshot) => {
                allProducts = [];
                categories = new Set(['all']);
                
                snapshot.forEach(childSnapshot => {
                    const product = { 
                        id: childSnapshot.key, 
                        ...childSnapshot.val() 
                    };
                    allProducts.push(product);
                    
                    // جمع الأقسام
                    if (product.category) {
                        categories.add(product.category);
                    }
                });
                
                // عرض أزرار الأقسام
                renderCategories();
                
                // عرض جميع المنتجات
                renderAllProducts();
                
                // تحميل السلة
                loadCart();
            });
        };

        // عرض أقسام المنتجات
        const renderCategories = () => {
            categoryFilter.innerHTML = '';
            
            categories.forEach(category => {
                const btn = document.createElement('button');
                btn.className = `category-btn ${category === 'all' ? 'active' : ''}`;
                btn.textContent = category === 'all' ? 'الكل' : category;
                btn.dataset.category = category;
                
                if (category === 'عروض') {
                    btn.classList.add('offer');
                }
                
                btn.addEventListener('click', () => {
                    // سيتم تنفيذ الفلترة عند النقر
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // تصفية المنتجات حسب القسم
                    if (category === 'all') {
                        renderAllProducts();
                    } else {
                        const filtered = allProducts.filter(p => p.category === category);
                        allProductsContainer.innerHTML = '';
                        
                        if (filtered.length === 0) {
                            allProductsContainer.innerHTML = `
                                <div class="no-products" style="grid-column: 1 / -1; text-align: center; padding: 40px 0;">
                                    <i class="fas fa-box-open" style="font-size: 3rem; color: var(--light-text); margin-bottom: 15px;"></i>
                                    <h3>لا توجد منتجات في هذا القسم</h3>
                                </div>
                            `;
                        } else {
                            filtered.forEach(product => {
                                renderProductCard(product, allProductsContainer);
                            });
                        }
                    }
                });
                
                categoryFilter.appendChild(btn);
            });
        };

        // متابعة حالة المستخدم
        const trackAuthState = () => {
            onAuthStateChanged(auth, (user) => {
                currentUser = user;
                
                if (user) {
                    // تحديث أيقونة المستخدم
                    userIcon.innerHTML = '<i class="fas fa-user-check"></i>';
                    userIcon.title = 'حسابك';
                    
                    // جلب بيانات المستخدم الإضافية
                    const userRef = ref(db, `users/${user.uid}`);
                    onValue(userRef, (snapshot) => {
                        const userData = snapshot.val();
                        if (userData) {
                            // يمكنك استخدام هذه البيانات في التطبيق
                            console.log('User data:', userData);
                        }
                    });
                } else {
                    userIcon.innerHTML = '<i class="fas fa-user"></i>';
                    userIcon.title = 'تسجيل الدخول';
                }
            });
        };

        // عرض سياسة الخدمة
        const showPolicy = (policyKey) => {
            const policy = policies[policyKey];
            if (!policy) return;
            
            policyTitle.textContent = policy.title;
            policyContent.innerHTML = policy.content;
            policyModal.classList.add('show');
        };

        // إضافة تقييم للمنتج
        const addProductReview = () => {
            if (!selectedProduct) return;
            
            if (!currentUser) {
                showAlert('يجب تسجيل الدخول لإضافة تقييم');
                authModal.classList.add('show');
                return;
            }
            
            if (selectedRating === 0) {
                showAlert('الرجاء اختيار تقييم من 1 إلى 5 نجوم');
                return;
            }
            
            if (!reviewText.value.trim()) {
                showAlert('الرجاء إضافة تعليقك عن المنتج');
                return;
            }
            
            const review = {
                userId: currentUser.uid,
                userName: currentUser.displayName || 'مستخدم',
                userAvatar: currentUser.photoURL || null,
                rating: selectedRating,
                comment: reviewText.value.trim(),
                date: new Date().toLocaleDateString('ar-EG')
            };
            
            const productRef = ref(db, `products/${selectedProduct.id}/reviews`);
            push(productRef, review)
                .then(() => {
                    showAlert('شكراً لتقييمك! تم إضافة تعليقك بنجاح');
                    reviewText.value = '';
                    selectedRating = 0;
                    updateRatingStars();
                    
                    // إعادة تحميل تفاصيل المنتج لرؤية التقييم الجديد
                    showProductDetail(selectedProduct.id);
                })
                .catch((error) => {
                    console.error('Error adding review:', error);
                    showAlert('حدث خطأ أثناء إضافة التقييم، يرجى المحاولة مرة أخرى');
                });
        };

        // تحديث عرض نجوم التقييم
        const updateRatingStars = () => {
            const stars = ratingInput.querySelectorAll('i');
            stars.forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.remove('far');
                    star.classList.add('fas');
                } else {
                    star.classList.remove('fas');
                    star.classList.add('far');
                }
            });
        };

        // تهيئة التطبيق
        const initApp = () => {
            fetchData();
            trackAuthState();
            
            // تحميل السلة
            loadCart();
            
            // تهيئة الخريطة (بدون تحديد موقع أولي)
            initMap();
        };

        // أحداث الأيقونات في شريط التنقل
        searchIcon.addEventListener('click', () => {
            showAlert('سيتم تفعيل البحث المتقدم في الإصدارات القادمة');
        });

        cartIcon.addEventListener('click', () => {
            cartModal.classList.add('show');
        });

        userIcon.addEventListener('click', () => {
            if (currentUser) {
                // عرض قائمة المستخدم
                showAlert(`مرحباً ${currentUser.displayName || 'عزيزي العميل'}`);
            } else {
                // عرض نافذة تسجيل الدخول
                authModal.classList.add('show');
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                authTitle.textContent = 'تسجيل الدخول';
                authSubtitle.textContent = 'ادخل بياناتك للوصول إلى حسابك';
            }
        });

        floatingCart.addEventListener('click', () => {
            cartModal.classList.add('show');
        });

        // إغلاق النوافذ
        closeCart.addEventListener('click', () => {
            cartModal.classList.remove('show');
        });

        closeAuth.addEventListener('click', () => {
            authModal.classList.remove('show');
        });

        closeConfirmation.addEventListener('click', () => {
            orderConfirmation.classList.remove('show');
        });

        closeDetail.addEventListener('click', () => {
            productDetailModal.classList.remove('show');
        });

        closePolicy.addEventListener('click', () => {
            policyModal.classList.remove('show');
        });

        // النقر خارج النوافذ لإغلاقها
        cartModal.addEventListener('click', (e) => {
            if (e.target === cartModal) {
                cartModal.classList.remove('show');
            }
        });

        authModal.addEventListener('click', (e) => {
            if (e.target === authModal) {
                authModal.classList.remove('show');
            }
        });

        productDetailModal.addEventListener('click', (e) => {
            if (e.target === productDetailModal) {
                productDetailModal.classList.remove('show');
            }
        });

        policyModal.addEventListener('click', (e) => {
            if (e.target === policyModal) {
                policyModal.classList.remove('show');
            }
        });

        // التبديل بين تسجيل الدخول والتسجيل
        showRegister.addEventListener('click', () => {
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            authTitle.textContent = 'إنشاء حساب جديد';
            authSubtitle.textContent = 'املأ النموذج لإنشاء حسابك';
        });

        showLogin.addEventListener('click', () => {
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            authTitle.textContent = 'تسجيل الدخول';
            authSubtitle.textContent = 'ادخل بياناتك للوصول إلى حسابك';
        });

        // معالجة تسجيل الدخول
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            loginUser(email, password);
        });

        // معالجة التسجيل
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showAlert('كلمة المرور غير متطابقة');
                return;
            }
            
            registerUser(name, email, phone, password);
        });

        // إرسال نموذج الطلب
        checkoutForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (cartItems.length === 0) {
                showAlert('سلة التسوق فارغة، يرجى إضافة منتجات قبل إرسال الطلب');
                return;
            }
            
            const location = userMarker ? userMarker.getLatLng() : null;
            
            const orderData = {
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerNotes: document.getElementById('customerNotes').value,
                items: cartItems,
                total: cartItems.reduce((total, item) => {
                    const product = allProducts.find(p => p.id === item.id) || item;
                    return total + (product.price * item.quantity);
                }, 0),
                status: 'pending',
                createdAt: new Date().toISOString(),
                location: location ? {
                    lat: location.lat,
                    lng: location.lng
                } : null
            };
            
            submitOrder(orderData);
        });

        // أحداث تفاصيل المنتج
        decreaseQuantity.addEventListener('click', () => updateQuantity(-1));
        increaseQuantity.addEventListener('click', () => updateQuantity(1));

        addToCartDetail.addEventListener('click', () => {
            if (selectedProduct) {
                addToCart(selectedProduct.id, productQuantity);
                productDetailModal.classList.remove('show');
            }
        });

        wishlistBtn.addEventListener('click', () => {
            wishlistBtn.innerHTML = wishlistBtn.classList.contains('active') ? 
                '<i class="far fa-heart"></i>' : '<i class="fas fa-heart"></i>';
            wishlistBtn.classList.toggle('active');
            
            showAlert(wishlistBtn.classList.contains('active') ? 
                'تمت إضافة المنتج إلى المفضلة' : 'تمت إزالة المنتج من المفضلة');
        });

        // تحديد الموقع
        detectLocationBtn.addEventListener('click', detectLocation);

        // أحداث التقييم
        ratingInput.querySelectorAll('i').forEach(star => {
            star.addEventListener('click', () => {
                selectedRating = parseInt(star.dataset.rating);
                updateRatingStars();
            });
            
            star.addEventListener('mouseover', () => {
                const rating = parseInt(star.dataset.rating);
                const stars = ratingInput.querySelectorAll('i');
                
                stars.forEach((s, index) => {
                    if (index < rating) {
                        s.classList.remove('far');
                        s.classList.add('fas');
                    } else {
                        s.classList.remove('fas');
                        s.classList.add('far');
                    }
                });
            });
            
            star.addEventListener('mouseout', () => {
                updateRatingStars();
            });
        });

        submitReview.addEventListener('click', addProductReview);

        // أحداث سياسات الخدمة
        faqLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPolicy('faq');
        });

        returnPolicyLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPolicy('returnPolicy');
        });

        shippingPolicyLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPolicy('shippingPolicy');
        });

        privacyPolicyLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPolicy('privacyPolicy');
        });

        termsLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPolicy('terms');
        });

        // أحداث الأزرار الأخرى
        shopNowBtn.addEventListener('click', () => {
            window.scrollTo({
                top: document.querySelector('.products-grid').offsetTop - 100,
                behavior: 'smooth'
            });
        });

        viewOffersBtn.addEventListener('click', () => {
            window.scrollTo({
                top: document.getElementById('allProducts').offsetTop - 100,
                behavior: 'smooth'
            });
        });

        // بدء التطبيق
        initApp();
    </script>
</body>
</html>
