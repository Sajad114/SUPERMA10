<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø±</title>
    <style>
        body {
            /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© */
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Tajawal', sans-serif;
    direction: rtl;
    text-align: right;
    background: #e0e5ec;
    padding: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
.container {
    width: 90%;
    max-width: 500px;
    background: #e0e5ec;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 8px 8px 16px #babecc, -8px -8px 16px #ffffff;
    text-align: center;
}

/* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
h2, h3 {
    color: #333;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}

/* Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
input, textarea, button {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border: none;
    border-radius: 10px;
    outline: none;
    font-size: 16px;
    background: #e0e5ec;
    box-shadow: inset 5px 5px 10px #babecc, inset -5px -5px 10px #ffffff;
    transition: 0.3s;
}

/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ */
input:focus, textarea:focus {
    box-shadow: inset 3px 3px 6px #babecc, inset -3px -3px 6px #ffffff;
}

/* Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© */
button {
    background: #28a745;
    color: white;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 5px 5px 10px #babecc, -5px -5px 10px #ffffff;
    transition: 0.3s;
}

/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± */
button:active {
    box-shadow: inset 3px 3px 6px #babecc, inset -3px -3px 6px #ffffff;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
#progressBarContainer {
    width: 100%;
    background: #e0e5ec;
    border-radius: 10px;
    margin-top: 15px;
    display: none;
    box-shadow: inset 5px 5px 10px #babecc, inset -5px -5px 10px #ffffff;
}

#progressBar {
    width: 0%;
    height: 12px;
    border-radius: 10px;
    background: #28a745;
    color: white;
    text-align: center;
    font-size: 12px;
    font-weight: bold;
}

/* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± */
#message {
    margin-top: 15px;
    font-size: 16px;
    font-weight: bold;
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
#productsList {
    margin-top: 20px;
    padding: 15px;
    border-radius: 10px;
    background: #e0e5ec;
    box-shadow: inset 5px 5px 10px #babecc, inset -5px -5px 10px #ffffff;
}

/* ÙƒÙ„ Ù…Ù†ØªØ¬ */
.product-item {
    display: flex;
    align-items: center;
    padding: 10px;
    border-bottom: 1px solid #ddd;
    transition: 0.3s;
}

.product-item img {
    width: 70px;
    height: 70px;
    border-radius: 10px;
    box-shadow: 3px 3px 6px #babecc, -3px -3px 6px #ffffff;
    margin-left: 15px;
}

.product-item p {
    font-size: 16px;
    font-weight: bold;
    color: #333;
}

/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ */
.product-item:hover {
    transform: scale(1.02);
    box-shadow: 5px 5px 10px #babecc, -5px -5px 10px #ffffff;
}

/* ğŸ¯ ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 600px) {
    .container {
        width: 95%;
        padding: 20px;
    }

    .product-item img {
        width: 50px;
        height: 50px;
    }
}
    </style>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.css">
</head>
<body>
    <div class="admin-panel" id="adminPanel">
        <div class="progress-bar-container" id="progressBarContainer">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>
        <h2 class="top-bar"></h2>
        <div class="form-group">
            <label for="coverImage">ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù:</label>
            <input type="file" id="coverImage" accept="image/*">
        </div>
        <div class="form-group">
            <label for="productName">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:</label>
            <input type="text" id="productName">
        </div>
        <div class="form-group">
            <label for="productPrice">Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬:</label>
            <input type="number" id="productPrice">
        </div>
        <div class="form-group">
            <label for="productDescription">ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬:</label>
            <textarea id="productDescription"></textarea>
        </div>
        <div class="form-group">
            <label for="detailImages">ØµÙˆØ± Ø§Ù„ØªÙØ§ØµÙŠÙ„ (4 ØµÙˆØ±):</label>
            <input type="file" id="detailImages" accept="image/*" multiple>
        </div>
        <div class="form-group">
            <label for="productVideo">ÙÙŠØ¯ÙŠÙˆ:</label>
            <input type="file" id="productVideo" accept="video/*">
        </div>
        <div class="form-group">
            <button id="addProductButton">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
        </div>
        <div class="search-bar">
            <input type="text" id="searchProduct" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬">
            <button id="searchButton">Ø¨Ø­Ø«</button>
        </div>
        <table class="product-table" id="productTable">
            <thead>
                <tr>
                    <th>ØµÙˆØ±Ø©</th>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„Ø³Ø¹Ø±</th>
                    <th>Ø§Ù„ÙˆØµÙ</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‡Ù†Ø§ -->
            </tbody>
        </table>
    </div>

    <div class="login-form" id="loginForm">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div class="form-group">
            <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
            <input type="text" id="username">
        </div>
        <div class="form-group">
            <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
            <input type="password" id="password">
        </div>
        <div class="form-group">
            <button id="loginButton">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <!-- jQuery -->
                <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.js"></script>

                <script type="module">
                    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
                    import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";
                    import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-storage.js";
                    import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

                    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
                    const firebaseConfig = {
                        apiKey: "AIzaSyADaBoLHAzuhsF_PffLp31hnkp0cmTK-18",
                        authDomain: "supermax-c14fd.firebaseapp.com",
                        databaseURL: "https://supermax-c14fd-default-rtdb.asia-southeast1.firebasedatabase.app",
                        projectId: "supermax-c14fd",
                        storageBucket: "supermax-c14fd.appspot.com",
                        messagingSenderId: "872444131439",
                        appId: "1:872444131439:web:f9369fe06b903b1599f59a",
                        measurementId: "G-8DSQ5M49HE"
                    };

                    const app = initializeApp(firebaseConfig);
                    const db = getDatabase(app);
                    const storage = getStorage(app);
                    const auth = getAuth(app);

                    // Ø¹Ù†Ø§ØµØ± DOM
                    const addProductButton = document.getElementById('addProductButton');
                    const productTable = document.getElementById('productTable').getElementsByTagName('tbody')[0];
                    const progressBarContainer = document.getElementById('progressBarContainer');
                    const progressBar = document.getElementById('progressBar');
                    const loginForm = document.getElementById('loginForm');
                    const adminPanel = document.getElementById('adminPanel');
                    const loginButton = document.getElementById('loginButton');

                    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    loginButton.addEventListener('click', async () => {
                        const username = document.getElementById('username').value;
                        const password = document.getElementById('password').value;

                        try {
                            await signInWithEmailAndPassword(auth, username, password);
                            alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.');
                            loginForm.style.display = 'none';
                            adminPanel.style.display = 'block';
                        } catch (error) {
                            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                            alert('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                        }
                    });

                    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
                    addProductButton.addEventListener('click', async () => {
                        const coverImage = document.getElementById('coverImage').files[0];
                        const productName = document.getElementById('productName').value;
                        const productPrice = document.getElementById('productPrice').value;
                        const productDescription = document.getElementById('productDescription').value;
                        const detailImages = document.getElementById('detailImages').files;
                        const productVideo = document.getElementById('productVideo').files[0];

                        progressBarContainer.style.display = 'block';

                        try {
                            // Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù
                            const coverImageRef = storageRef(storage, `coverImages/${coverImage.name}`);
                            await uploadBytes(coverImageRef, coverImage);
                            const coverImageUrl = await getDownloadURL(coverImageRef);

                            // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
                            const detailImageUrls = [];
                            for (let i = 0; i < detailImages.length; i++) {
                                const image = detailImages[i];
                                const detailImageRef = storageRef(storage, `detailImages/${image.name}`);
                                await uploadBytes(detailImageRef, image);
                                const detailImageUrl = await getDownloadURL(detailImageRef);
                                detailImageUrls.push(detailImageUrl);

                                progressBar.style.width = `${((i + 1) / detailImages.length) * 100}%`;
                                progressBar.innerText = `${Math.round(((i + 1) / detailImages.length) * 100)}%`;
                            }

                            // Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ù†ØªØ¬
                            const productVideoRef = storageRef(storage, `productVideos/${productVideo.name}`);
                            await uploadBytes(productVideoRef, productVideo);
                            const productVideoUrl = await getDownloadURL(productVideoRef);

                            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            const productRef = push(ref(db, 'products'));
                            await set(productRef, {
                                coverImage: coverImageUrl,
                                name: productName,
                                price: productPrice,
                                description: productDescription,
                                detailImages: detailImageUrls,
                                video: productVideoUrl
                            });

                            showAlert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­.', 'success');
                        } catch (error) {
                            console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬:", error);
                            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'danger');
                        } finally {
                            loadProducts();
                            progressBarContainer.style.display = 'none';
                            progressBar.style.width = '0%';
                            progressBar.innerText = '0%';
                        }
                    });

                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬
                    document.getElementById('searchButton').addEventListener('click', () => {
                        const searchQuery = document.getElementById('searchProduct').value.toLowerCase();
                        const rows = productTable.getElementsByTagName('tr');

                        for (let i = 0; i < rows.length; i++) {
                            const cells = rows[i].getElementsByTagName('td');
                            let match = false;

                            for (let j = 0; j < cells.length; j++) {
                                if (cells[j].innerText.toLowerCase().includes(searchQuery)) {
                                    match = true;
                                    break;
                                }
                            }

                            if (match) {
                                rows[i].style.display = '';
                            } else {
                                rows[i].style.display = 'none';
                            }
                        }
                    });

                    // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡
                    function showAlert(message, type) {
                        const alertDiv = document.createElement('div');
                        alertDiv.className = `alert ${type}`;
                        alertDiv.innerHTML = `${message} <span class="closebtn">&times;</span>`;
                        document.body.appendChild(alertDiv);

                        const closeBtn = alertDiv.querySelector('.closebtn');
                        closeBtn.addEventListener('click', () => {
                            alertDiv.remove();
                        });

                        setTimeout(() => {
                            alertDiv.remove();
                        }, 5000);
                    }

                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                    async function loadProducts() {
                        productTable.innerHTML = '';
                        onValue(ref(db, 'products'), (snapshot) => {
                            const products = snapshot.val();
                            if (products) {
                                Object.keys(products).forEach((key) => {
                                    const product = products[key];
                                    const row = productTable.insertRow();

                                    const coverCell = row.insertCell(0);
                                    const nameCell = row.insertCell(1);
                                    const priceCell = row.insertCell(2);
                                    const descriptionCell = row.insertCell(3);
                                    const actionsCell = row.insertCell(4);

                                    coverCell.innerHTML = `<img src="${product.coverImage}" alt="${product.name}" width="50">`;
                                    nameCell.innerText = product.name;
                                    priceCell.innerText = product.price;
                                    descriptionCell.innerText = product.description;

                                    const deleteButton = document.createElement('button');
                                    deleteButton.innerText = 'Ø­Ø°Ù';
                                    deleteButton.addEventListener('click', async () => {
                                        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
                                            await remove(ref(db, `products/${key}`));
                                            loadProducts();
                                        }
                                    });
                                    actionsCell.appendChild(deleteButton);
                                });
                            }
                        });
                    }

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    window.onload = () => {
                        auth.onAuthStateChanged((user) => {
                            if (user) {
                                loginForm.style.display = 'none';
                                adminPanel.style.display = 'block';
                                loadProducts();
                            } else {
                                loginForm.style.display = 'block';
                                adminPanel.style.display = 'none';
                            }
                        });
                    };
                </script>
            </body>
            </html>
